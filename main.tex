\documentclass[11pt,a4paper,twoside]{book}

% === PACKAGES ===
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning, shapes.geometric}
\usepackage{tcolorbox}
\usepackage{fontawesome5}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{fancyhdr}
\usepackage{geometry}
\usepackage{qrcode}        % QR codes pour liens interactifs

% === GEOMETRY ===
\geometry{
    left=2.5cm,
    right=2.5cm,
    top=2.5cm,
    bottom=2.5cm
}

% === COLORS ===
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\definecolor{cyberblue}{RGB}{0,120,215}
\definecolor{cyberorange}{RGB}{255,140,0}
\definecolor{cybergreen}{RGB}{0,180,80}

% === CODE LISTINGS ===
\lstdefinestyle{python}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{cyberblue}\bfseries,
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    language=Python
}
\lstset{style=python}

% === PSEUDOCODE ===
\algrenewcommand\algorithmicrequire{\textbf{Entree:}}
\algrenewcommand\algorithmicensure{\textbf{Sortie:}}
\algrenewcommand\algorithmicif{\textbf{Si}}
\algrenewcommand\algorithmicthen{\textbf{alors}}
\algrenewcommand\algorithmicelse{\textbf{sinon}}
\algrenewcommand\algorithmicfor{\textbf{Pour}}
\algrenewcommand\algorithmicwhile{\textbf{Tant que}}
\algrenewcommand\algorithmicdo{\textbf{faire}}
\algrenewcommand\algorithmicreturn{\textbf{Retourner}}

% === CUSTOM BOXES ===
\tcbuselibrary{skins,breakable}

% Box: Histoire (pour enfants)
\newtcolorbox{histoire}{
    colback=cyan!5,
    colframe=cyberblue,
    fonttitle=\bfseries,
    title={\faBookOpen\ L'Histoire},
    breakable
}

% Box: Concept cle
\newtcolorbox{concept}{
    colback=green!5,
    colframe=cybergreen,
    fonttitle=\bfseries,
    title={\faLightbulb\ Concept Cle},
    breakable
}

% Box: Piege a eviter
\newtcolorbox{piege}{
    colback=red!5,
    colframe=red!70!black,
    fonttitle=\bfseries,
    title={\faExclamationTriangle\ Piege a Eviter},
    breakable
}

% Box: Application cyber
\newtcolorbox{cyber}{
    colback=orange!5,
    colframe=cyberorange,
    fonttitle=\bfseries,
    title={\faShield*\ En Cybersecurite},
    breakable
}

% Box: Exercice
\newtcolorbox{exercice}{
    colback=gray!5,
    colframe=gray!70!black,
    fonttitle=\bfseries,
    title={\faPencil*\ Exercice},
    breakable
}

% === COMMANDES INTERACTIVES ===
% Lien Replit avec QR code
\newcommand{\replit}[2]{%
    \begin{tcolorbox}[
        colback=blue!5,
        colframe=cyberblue,
        fonttitle=\bfseries,
        title={\faCode\ Tester en ligne},
        boxrule=1pt
    ]
    \begin{minipage}{0.75\textwidth}
        \textbf{#1}\\[0.3em]
        \url{#2}\\[0.5em]
        \small Scanne le QR code ou clique sur le lien pour ouvrir l'environnement de code.
    \end{minipage}%
    \hfill
    \begin{minipage}{0.2\textwidth}
        \centering
        \qrcode[height=2cm]{#2}
    \end{minipage}
    \end{tcolorbox}
}

% Lien Colab (pour notebooks)
\newcommand{\colab}[2]{%
    \begin{tcolorbox}[
        colback=yellow!5,
        colframe=orange!80!black,
        fonttitle=\bfseries,
        title={\faGoogle\ Google Colab},
        boxrule=1pt
    ]
    \begin{minipage}{0.75\textwidth}
        \textbf{#1}\\[0.3em]
        \url{#2}
    \end{minipage}%
    \hfill
    \begin{minipage}{0.2\textwidth}
        \centering
        \qrcode[height=2cm]{#2}
    \end{minipage}
    \end{tcolorbox}
}

% Version inline (juste le QR + lien)
\newcommand{\codelink}[1]{%
    \marginpar{%
        \centering
        \qrcode[height=1.5cm]{#1}\\
        \tiny\url{#1}
    }%
}

% === THEOREMS ===
\theoremstyle{definition}
\newtheorem{definition}{Definition}[chapter]
\newtheorem{exemple}{Exemple}[chapter]
\newtheorem{propriete}{Propriete}[chapter]

% === HEADERS ===
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO]{\nouppercase{\rightmark}}
\fancyhead[RE]{\nouppercase{\leftmark}}

% === META ===
\title{
    \Huge\textbf{Apprendre la Cyber par les Challenges}\\[0.5cm]
    \Large Du Lycee a l'Universite\\[1cm]
    \IfFileExists{assets/logo.png}{%
        \includegraphics[width=0.4\textwidth]{assets/logo.png}
    }{%
        \begin{tikzpicture}
            \node[draw=cyberblue, line width=2pt, rounded corners=10pt,
                  inner sep=15pt, font=\Huge\bfseries\color{cyberblue}] {LearnByAoC};
        \end{tikzpicture}
    }
}
\author{
    \Large Professeur Kali\\[0.3cm]
    \normalsize Base sur les challenges Advent of Code
}
\date{\today}

% === DOCUMENT ===
\begin{document}

\frontmatter
\maketitle

\tableofcontents

\chapter*{Preface}
\addcontentsline{toc}{chapter}{Preface}

Ce livre est ne d'une conviction : \textbf{on apprend mieux en resolvant des problemes qu'en lisant des cours}.

Les challenges d'Advent of Code, crees par Eric Wastl depuis 2015, offrent une progression ideale pour apprendre la programmation et la pensee algorithmique. Plus de 250 problemes, du plus simple au plus complexe, couvrant pratiquement tous les concepts fondamentaux de l'informatique.

\textbf{Comment utiliser ce livre ?}

\begin{itemize}
    \item Chaque chapitre couvre un \textbf{concept} (pas une annee d'AoC)
    \item Les concepts sont ordonnes par \textbf{prerequis}
    \item Chaque concept est illustre par plusieurs \textbf{challenges}
    \item Les explications vont du plus simple (10 ans) au plus technique
\end{itemize}

\begin{cyber}
Chaque concept est relie a une application concrete en cybersecurite. Tu ne fais pas que resoudre des puzzles - tu construis des competences reelles.
\end{cyber}

\vfill

\textit{``On n'apprend pas a nager en lisant un livre. On saute dans l'eau, on boit la tasse, puis on comprend.''}

\chapter*{Carte des Concepts}
\addcontentsline{toc}{chapter}{Carte des Concepts}

Le graphe ci-dessous montre les \textbf{dependances entre concepts}. Une fleche de A vers B signifie que tu dois maitriser A avant d'apprendre B.

\begin{center}
\resizebox{\textwidth}{!}{%
\input{assets/dependency_graph.tex}
}
\end{center}

\textbf{Legende des couleurs :}
\begin{itemize}
    \item \textcolor{green!60!black}{\textbf{Vert}} : Niveau Debutant (Lycee)
    \item \textcolor{blue!60!black}{\textbf{Bleu}} : Niveau Intermediaire (Bac / L1)
    \item \textcolor{red!60!black}{\textbf{Rouge}} : Niveau Avance (L2 / L3)
    \item \textcolor{purple!60!black}{\textbf{Violet}} : Niveau Expert (Master)
\end{itemize}

Les nombres entre parentheses indiquent combien de fois ce concept apparait dans les 257 challenges Advent of Code (2015-2025).

\mainmatter

% === PARTIE 1 : FONDATIONS ===
\part{Fondations}

\include{chapters/01_parsing}
\include{chapters/02_arithmetique}
\include{chapters/03_recherche}
\include{chapters/04_grilles}

% === PARTIE 2 : STRUCTURES ===
\part{Structures de Donnees}

\include{chapters/05_ensembles}
\include{chapters/06_dictionnaires}
\include{chapters/07_piles_files}
\include{chapters/08_arbres}

% === PARTIE 3 : ALGORITHMES ===
\part{Algorithmes}

\include{chapters/09_recursion}
\include{chapters/10_graphes}
\include{chapters/11_programmation_dynamique}
\include{chapters/12_simulation}

% === PARTIE 4 : APPLICATIONS ===
\part{Applications Cyber}

\include{chapters/13_crypto}
\include{chapters/14_parsing_avance}
\include{chapters/15_optimisation}

% === ANNEXES ===
\appendix
\part{Annexes}

\include{chapters/A_python_reference}
\include{chapters/B_complexite}
\include{chapters/C_challenges_index}

\backmatter

\chapter*{Index des Challenges}
\addcontentsline{toc}{chapter}{Index des Challenges}

% Index par annee et par concept - a generer

\end{document}
